<VirtualHost *:80>
    ServerName <%= server_name %>
    DocumentRoot <%= root %>/web

    LogLevel warn
    ErrorLog <%= root %>/app/logs/error.log
    CustomLog <%= root %>/app/logs/access.log combined

    DirectoryIndex <%= controller %>
    Options +Indexes +FollowSymLinks +MultiViews -SymLinksIfOwnerMatch

    <Directory <%= root %>/web/>

        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /

            RewriteCond %{HTTP_HOST} ^(www\.)(.+)
            RewriteRule ^ http://%2%{REQUEST_URI} [R=301,L]

            # Cache-busting
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^assets\/(\d+)\/(.+)\.(js|css|png|jpg|gif|ico)$ $2.$3 [L]

            RewriteCond %{HTTPS} !=on
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteRule ^(.*)$ /<%= controller %> [QSA,L]
        </IfModule>
    </Directory>
</VirtualHost>